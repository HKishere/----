C51 COMPILER V9.01   MAIN                                                                  12/12/2018 10:19:39 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c LARGE BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "STC12C5A60S2.h"
   2          #include <INTRINS.H>
   3          #include "main.h"
   4          #include "lcd.h"
*** ERROR C231 IN LINE 9 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'ACC': redefinition
*** ERROR C231 IN LINE 10 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'B': redefinition
*** ERROR C231 IN LINE 11 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'PSW': redefinition
*** ERROR C231 IN LINE 13 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'CY': redefinition
*** ERROR C231 IN LINE 14 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'AC': redefinition
*** ERROR C231 IN LINE 15 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'F0': redefinition
*** ERROR C231 IN LINE 16 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'RS1': redefinition
*** ERROR C231 IN LINE 17 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'RS0': redefinition
*** ERROR C231 IN LINE 18 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'OV': redefinition
*** ERROR C231 IN LINE 19 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P': redefinition
*** ERROR C231 IN LINE 21 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'SP': redefinition
*** ERROR C231 IN LINE 22 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'DPL': redefinition
*** ERROR C231 IN LINE 23 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'DPH': redefinition
*** ERROR C231 IN LINE 27 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'PCON': redefinition
*** ERROR C231 IN LINE 29 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'AUXR': redefinition
*** ERROR C231 IN LINE 31 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'AUXR1': redefinition
*** ERROR C231 IN LINE 58 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'WAKE_CLKO': redefinition
*** ERROR C231 IN LINE 73 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'CLK_DIV': redefinition
*** ERROR C231 IN LINE 75 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'BUS_SPEED': redefinition
*** ERROR C231 IN LINE 98 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'IE': redefinition
*** ERROR C231 IN LINE 100 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'EA': redefinition
*** ERROR C231 IN LINE 101 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'ELVD': redefinition
*** ERROR C231 IN LINE 102 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'EADC': redefinition
*** ERROR C231 IN LINE 103 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'ES': redefinition
*** ERROR C231 IN LINE 104 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'ET1': redefinition
*** ERROR C231 IN LINE 105 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'EX1': redefinition
*** ERROR C231 IN LINE 106 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'ET0': redefinition
*** ERROR C231 IN LINE 107 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'EX0': redefinition
*** ERROR C231 IN LINE 109 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'IE2': redefinition
*** ERROR C231 IN LINE 112 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'IP': redefinition
*** ERROR C231 IN LINE 114 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'PPCA': redefinition
*** ERROR C231 IN LINE 115 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'PLVD': redefinition
*** ERROR C231 IN LINE 116 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'PADC': redefinition
*** ERROR C231 IN LINE 117 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'PS': redefinition
*** ERROR C231 IN LINE 118 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'PT1': redefinition
*** ERROR C231 IN LINE 119 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'PX1': redefinition
*** ERROR C231 IN LINE 120 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'PT0': redefinition
*** ERROR C231 IN LINE 121 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'PX0': redefinition
*** ERROR C231 IN LINE 124 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'IPH': redefinition
*** ERROR C231 IN LINE 125 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'IP2': redefinition
*** ERROR C231 IN LINE 130 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P0': redefinition
*** ERROR C231 IN LINE 131 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P00': redefinition
*** ERROR C231 IN LINE 132 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P01': redefinition
*** ERROR C231 IN LINE 133 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P02': redefinition
*** ERROR C231 IN LINE 134 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P03': redefinition
*** ERROR C231 IN LINE 135 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P04': redefinition
*** ERROR C231 IN LINE 136 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P05': redefinition
*** ERROR C231 IN LINE 137 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P06': redefinition
*** ERROR C231 IN LINE 138 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P07': redefinition
*** ERROR C231 IN LINE 139 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P0M0': redefinition
*** ERROR C231 IN LINE 140 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P0M1': redefinition
C51 COMPILER V9.01   MAIN                                                                  12/12/2018 10:19:39 PAGE 2   

*** ERROR C231 IN LINE 141 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P1': redefinition
*** ERROR C231 IN LINE 142 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P10': redefinition
*** ERROR C231 IN LINE 143 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P11': redefinition
*** ERROR C231 IN LINE 144 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P12': redefinition
*** ERROR C231 IN LINE 145 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P13': redefinition
*** ERROR C231 IN LINE 146 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P14': redefinition
*** ERROR C231 IN LINE 147 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P15': redefinition
*** ERROR C231 IN LINE 148 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P16': redefinition
*** ERROR C231 IN LINE 149 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P17': redefinition
*** ERROR C231 IN LINE 150 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P1M0': redefinition
*** ERROR C231 IN LINE 151 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P1M1': redefinition
*** ERROR C231 IN LINE 152 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P1ASF': redefinition
*** ERROR C231 IN LINE 153 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P2': redefinition
*** ERROR C231 IN LINE 154 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P20': redefinition
*** ERROR C231 IN LINE 155 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P21': redefinition
*** ERROR C231 IN LINE 156 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P22': redefinition
*** ERROR C231 IN LINE 157 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P23': redefinition
*** ERROR C231 IN LINE 158 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P24': redefinition
*** ERROR C231 IN LINE 159 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P25': redefinition
*** ERROR C231 IN LINE 160 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P26': redefinition
*** ERROR C231 IN LINE 161 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P27': redefinition
*** ERROR C231 IN LINE 162 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P2M0': redefinition
*** ERROR C231 IN LINE 163 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P2M1': redefinition
*** ERROR C231 IN LINE 164 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P3': redefinition
*** ERROR C231 IN LINE 165 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P30': redefinition
*** ERROR C231 IN LINE 166 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P31': redefinition
*** ERROR C231 IN LINE 167 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P32': redefinition
*** ERROR C231 IN LINE 168 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P33': redefinition
*** ERROR C231 IN LINE 169 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P34': redefinition
*** ERROR C231 IN LINE 170 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P35': redefinition
*** ERROR C231 IN LINE 171 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P36': redefinition
*** ERROR C231 IN LINE 172 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P37': redefinition
*** ERROR C231 IN LINE 173 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P3M0': redefinition
*** ERROR C231 IN LINE 174 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P3M1': redefinition
*** ERROR C231 IN LINE 175 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P4': redefinition
*** ERROR C231 IN LINE 176 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P40': redefinition
*** ERROR C231 IN LINE 177 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P41': redefinition
*** ERROR C231 IN LINE 178 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P42': redefinition
*** ERROR C231 IN LINE 179 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P43': redefinition
*** ERROR C231 IN LINE 180 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P44': redefinition
*** ERROR C231 IN LINE 181 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P45': redefinition
*** ERROR C231 IN LINE 182 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P46': redefinition
*** ERROR C231 IN LINE 183 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P47': redefinition
*** ERROR C231 IN LINE 184 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P4M0': redefinition
*** ERROR C231 IN LINE 185 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P4M1': redefinition
*** ERROR C231 IN LINE 187 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P4SW': redefinition
*** ERROR C231 IN LINE 189 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P5': redefinition
*** ERROR C231 IN LINE 190 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P50': redefinition
*** ERROR C231 IN LINE 191 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P51': redefinition
*** ERROR C231 IN LINE 192 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P52': redefinition
*** ERROR C231 IN LINE 193 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P53': redefinition
*** ERROR C231 IN LINE 194 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P5M0': redefinition
*** ERROR C231 IN LINE 195 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'P5M1': redefinition
*** ERROR C231 IN LINE 199 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'TCON': redefinition
*** ERROR C231 IN LINE 201 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'TF1': redefinition
*** ERROR C231 IN LINE 202 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'TR1': redefinition
*** ERROR C231 IN LINE 203 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'TF0': redefinition
*** ERROR C231 IN LINE 204 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'TR0': redefinition
*** ERROR C231 IN LINE 205 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'IE1': redefinition
*** ERROR C231 IN LINE 206 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'IT1': redefinition
*** ERROR C231 IN LINE 207 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'IE0': redefinition
*** ERROR C231 IN LINE 208 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'IT0': redefinition
C51 COMPILER V9.01   MAIN                                                                  12/12/2018 10:19:39 PAGE 3   

*** ERROR C231 IN LINE 210 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'TMOD': redefinition
*** ERROR C231 IN LINE 211 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'TL0': redefinition
*** ERROR C231 IN LINE 212 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'TH0': redefinition
*** ERROR C231 IN LINE 213 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'TL1': redefinition
*** ERROR C231 IN LINE 214 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'TH1': redefinition
*** ERROR C231 IN LINE 218 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'SCON': redefinition
*** ERROR C231 IN LINE 220 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'SM0': redefinition
*** ERROR C231 IN LINE 221 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'SM1': redefinition
*** ERROR C231 IN LINE 222 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'SM2': redefinition
*** ERROR C231 IN LINE 223 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'REN': redefinition
*** ERROR C231 IN LINE 224 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'TB8': redefinition
*** ERROR C231 IN LINE 225 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'RB8': redefinition
*** ERROR C231 IN LINE 226 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'TI': redefinition
*** ERROR C231 IN LINE 227 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'RI': redefinition
*** ERROR C231 IN LINE 229 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'SBUF': redefinition
*** ERROR C231 IN LINE 230 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'SADEN': redefinition
*** ERROR C231 IN LINE 231 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'SADDR': redefinition
*** ERROR C231 IN LINE 234 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'S2CON': redefinition
*** ERROR C231 IN LINE 235 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'S2BUF': redefinition
*** ERROR C231 IN LINE 236 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'BRT': redefinition
*** ERROR C231 IN LINE 239 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'WDT_CONTR': redefinition
*** ERROR C231 IN LINE 247 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'CCON': redefinition
*** ERROR C231 IN LINE 249 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'CF': redefinition
*** ERROR C231 IN LINE 250 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'CR': redefinition
*** ERROR C231 IN LINE 253 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'CCF1': redefinition
*** ERROR C231 IN LINE 254 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'CCF0': redefinition
*** ERROR C231 IN LINE 256 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'CMOD': redefinition
*** ERROR C231 IN LINE 276 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'CL': redefinition
*** ERROR C231 IN LINE 277 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'CH': redefinition
*** ERROR C231 IN LINE 280 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'CCAPM0': redefinition
*** ERROR C231 IN LINE 281 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'CCAPM1': redefinition
*** ERROR C231 IN LINE 308 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'CCAP0L': redefinition
*** ERROR C231 IN LINE 309 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'CCAP0H': redefinition
*** ERROR C231 IN LINE 310 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'CCAP1L': redefinition
*** ERROR C231 IN LINE 311 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'CCAP1H': redefinition
*** ERROR C231 IN LINE 314 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'PCA_PWM0': redefinition
*** ERROR C231 IN LINE 315 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'PCA_PWM1': redefinition
*** ERROR C231 IN LINE 324 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'ADC_CONTR': redefinition
*** ERROR C231 IN LINE 325 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'ADC_RES': redefinition
*** ERROR C231 IN LINE 326 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'ADC_RESL': redefinition
*** ERROR C231 IN LINE 330 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'SPCTL': redefinition
*** ERROR C231 IN LINE 331 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'SPSTAT': redefinition
*** ERROR C231 IN LINE 332 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'SPDAT': redefinition
*** ERROR C231 IN LINE 335 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'IAP_DATA': redefinition
*** ERROR C231 IN LINE 336 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'IAP_ADDRH': redefinition
*** ERROR C231 IN LINE 337 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'IAP_ADDRL': redefinition
*** ERROR C231 IN LINE 339 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'IAP_CMD': redefinition
*** ERROR C231 IN LINE 340 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'IAP_TRIG': redefinition
*** ERROR C231 IN LINE 341 OF C:\KEIL\C51\INC\STC12C5A60S2.H: 'IAP_CONTR': redefinition
   5          #include "timer.h"
   6          #include "stdio.h"      
   7          //#include "pid.h"
   8          #include "pt100.h"
   9          
  10          int set_temperature=66;                            //温度设定在经济
  11          float gxlb_wendu=0;                                //惯性滤波后的温度
  12          float av_wendu=0;                                  //采样50次后求平均值
  13          float gc_wendu=0;                                  //工程计算后的温度
  14          unsigned int fd_wendu=0;                           //将工程计算后的温度放大100倍
  15          unsigned int lvbo[50]={0};                         //平均滤波数组
  16          unsigned char L=0;                                 //平均滤波数组变量
  17          unsigned int sum=0;                                //数组求和
C51 COMPILER V9.01   MAIN                                                                  12/12/2018 10:19:39 PAGE 4   

  18          char count;                                        //数组计数
  19          float  KP0=30;                                     //PID算法中比例系数
  20          float  KI0=0.5;                                    //PID算法中积分系数
  21          float  KD0=80;                                     //PID算法中微分系数
  22          float  Error=0;                                    //PID算法中当前偏差
  23          float  PreError=0;                                 //PID算法中上次偏差
  24          float  PPreError=0;                                //PID算法中上上次偏差
  25          float  Det=0;                                      //PID算法计算结果
  26          int Time_On=50;                                    //PWM波的周期
  27          
  28          
  29          /*******************************************************************************
  30          * 函数名         : junzhi_lvbo_10
  31          * 函数功能                 : AD采样温度数值平均值滤波，惯性滤波，工程量转换函数
  32          * 输入           : AD采样温度数值
  33          * 输出           : 显示工程量值，摄氏度
  34          * 注意                 ：当显示温度与实际温度有误差时，请调节工程量转换参数
  35          *******************************************************************************/
  36          void junzhi_lvbo_10(unsigned int A)
  37          {
  38   1              lvbo[L++]=A;
  39   1              if(L==50)
  40   1              {
  41   2              L=0;
  42   2              for(count=0,sum=0;count<50;count++)
  43   2                      {
  44   3                              sum+=lvbo[count];
  45   3                      }
  46   2                        av_wendu = sum/50;                                        //求平均数
  47   2                        gxlb_wendu    =av_wendu * 0.7 + gxlb_wendu *0.3;            //惯性滤波
  48   2                        gc_wendu=(gxlb_wendu*100/1024-30)/0.72;                   //工程量转换1
  49   2                        fd_wendu=gc_wendu * 100 ;                                 //放大100倍
  50   2              }
  51   1      }
  52          
  53          
  54          /*******************************************************************************
  55          * 函数名         : PID
  56          * 函数功能                 : PID算法，
  57          * 输入           : Time_On原始PWM开度
  58          * 输出           : Time_On调整后PWM开度
  59          *******************************************************************************/                
  60          void PID()
  61          {
  62   1              PPreError=PreError;                                                  //将上次偏差赋给上上次偏差     
  63   1              PreError=Error;                                                      //将当前偏差赋给上次偏差
  64   1              Error=set_temperature-gc_wendu;                                      //计算偏差
  65   1              Det=KP0*(Error-PreError)+KI0*Error+KD0*(Error-2*PreError+PPreError); //增量式PID计算公式：△u(k)=Kp*(e(k)
             --e(k-1))+Ki*e(k)+Kd*(e(k)-2*e(k-1)+e(k-2))
  66   1              Time_On=Time_On+Det;                                                 //u(k)=u(k)+△u(k)
  67   1              if(Time_On>100) Time_On=100;                                         //防计算结果超出设定周期            
             -   
  68   1              if(Time_On<0)   Time_On=0;                                             //防计算结果低于最小占空比
  69   1      }
  70          
  71          
  72          /*******************************************************************************
  73          * 函数名         : main
  74          * 函数功能                 : 主程序计算
  75          * 输入           : 无
  76          * 输出           : 无
  77          *******************************************************************************/
C51 COMPILER V9.01   MAIN                                                                  12/12/2018 10:19:39 PAGE 5   

  78          void main()
  79          {
  80   1                      LcdInit();                                                          //液晶屏初始化                      
             -    
  81   1                      LCD_dis_data3(1,4,set_temperature);                                 //数字代表第一行第四列，显示温度给定
             -值
  82   1                      Delay1ms(10);                                                       //延时5毫秒
  83   1                      init_timer0();                                                          //单片机定时器初始化
  84   1                      InitADC();                                                          //AD采样初始化
  85   1                      EA=1;                                                               //总中断开关
  86   1                      EADC=1;                                                             //ADC中断使能位
  87   1                      while(1)
  88   1                      { 
  89   2                                      junzhi_lvbo_10(ADC);                                              //AD转换数据滤波
  90   2                                      Display1(2,4,fd_wendu);                                         //显示当前温度                        
             -                 
  91   2                                      PID();                                                          //进入PID计算
  92   2                      }       
  93   1      }
  94          

C51 COMPILATION COMPLETE.  0 WARNING(S),  162 ERROR(S)
